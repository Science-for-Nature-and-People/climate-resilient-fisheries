---
title: "Knowledge and Learning Synthesis Paper"
author: "Meghan Fletcher"
date: "3/9/2022"
output: 
  html_document:
    theme: flatly
    code_folding: hide
    toc: true
    toc_float: true
---

```{r setup, include=FALSE, message = FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

```

# Load data

```{r}
library(here)
source(here("case_study_analysis","mf_clustering_analysis","00-load-libraries.R"))
load(here("case_study_analysis","mf_clustering_analysis","data","attribs.Rdata")) # from 01-prep-data.Rmd
load(here("case_study_analysis","mf_clustering_analysis","data","attributes_merged_clean.Rdata"))
```


##################################################################################################

# Knowledge and Learning Attributes Clustering

```{r}
# Create a subset of data with only the knowledge and learning attributes
knowledge_data <- attribs %>% 
  select(case_study, attribute_id, score, numeric_importance) %>% 
  filter(attribute_id %in% c("Social_economic_Knowledge_diversity", "Social_economic_Knowledge_access", "Social_economic_Learning_capacity", "Goverance_Adaptive"))
```

## Clustering Analyses for Attibute Score

```{r}
# Dendrogram based on hclust
knowledge_clust <- knowledge_data %>% 
  select(case_study, attribute_id, score) %>% 
  pivot_wider(names_from = attribute_id ,values_from = score)
 
knowledge_hc <- knowledge_clust %>% 
  column_to_rownames(var = "case_study") %>% 
  mutate(across(everything(),~scale(.x))) %>% 
  mutate(across(everything(), ~replace_na(.x, 0))) %>% # REVIEW
  as.matrix() %>% 
  dist() %>% hclust(method = "ward.D2")


plot(knowledge_hc)

library(ape)
plot(as.phylo(knowledge_hc), type = "unrooted", cex = 0.6,
     no.margin = TRUE)

library(ggdendro)
ggdendrogram(knowledge_hc, rotate = TRUE, theme_dendro = FALSE)
```







